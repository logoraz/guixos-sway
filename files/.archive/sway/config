# Sway Configuration

# #:TODO/251021 |--> Convert to home-sway-service-type configuration
# 1. https://guix.gnu.org/manual/devel/en/html_node/Sway-window-manager.html
# 2. https://systemcrafters.net/live-streams/april-4-2025/

set $mod Mod4

#include "~/.config/sway/before-config"

# Configure System Theme Settings

# UI variables
set $system_theme 'Adwaita-dark'
set $system_icons 'Qogir-dark'
set $system_font 'Iosevka Aile 11'
set $system_dpi_scaling_factor 1.6
set $system_text_scaling_factor 1
set $cursor_size 20
set $cursor_theme 'Bibata-Modern-Classic'
set $titlebar_font 'Iosevka Ail'
set $titlebar_text_size 11

# GTK
# This is the only place where you must set GTK scaling
set $gnome-schema org.gnome.desktop.interface
exec_always {
  gsettings set $gnome-schema gtk-theme $system_theme
  gsettings set $gnome-schema icon-theme $system_icons
  gsettings set $gnome-schema text-scaling-factor $system_text_scaling_factor
  gsettings set $gnome-schema cursor-theme $cursor_theme
  gsettings set $gnome-schema cursor-size $cursor_size
}

# Mouse
seat seat0 xcursor_theme $cursor_theme $cursor_size

# Fonts (For sway window titles only)
font pango:$titlebar_font $titlebar_text_size

# Configure displays

# The annoying thing is that sometimes the display ID changes when hotplugging
# my Thunderbolt dock...
# set $primary DP-2 DP-3 DP-7 DP-8 HDMI-A-1
set $laptop eDP-1

output $laptop scale $system_dpi_scaling_factor
# output DP-2 res 2560x1440@59.951hz pos 0 0 scale 2
# output DP-2 pos 0 0 scale 2
# output DP-3 pos 0 0 scale 2
# output DP-7 pos 0 0 scale 2
# output DP-8 pos 0 0 scale 2
# output HDMI-A-1 scale 2

# Set Background
output "*" bg ~/guixos/files/assets/wallpapers/primary-wall.jpg fill

# Toggle Displays
# bindsym $mod+Shift+s exec ~/.config/sway/bin/toggle-display $primary

input type:keyboard {
    xkb_layout us,il
    xkb_options ctrl:nocaps
}

# Set default brightness & backlight
exec brightnessctl set 50%
exec brightnessctl -d chromeos::kbd_backlight set 10%

# Set system font
font pango:JetBrains Mono 12

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

# Sway System Controls
bindsym $mod+Shift+q kill
bindsym $mod+Shift+x exit
bindsym $mod+Shift+r reload

# Disable Touchpad (Default disabled)
input type:touchpad {
    events disabled
}
bindsym $mod+Shift+t exec swaymsg input type:touchpad events toggle enabled disabled

# Window Focus
bindsym $mod+h focus left
bindsym $mod+l focus right

# Move workspace to display
bindsym $mod+Mod1+h move workspace to output left
bindsym $mod+Mod1+l move workspace to output right
bindsym $mod+Mod1+Left move workspace to output left
bindsym $mod+Mod1+Right move workspace to output right

# alternatively, you can use the cursor keys:
bindsym $mod+Shift+h move left 30 px
bindsym $mod+Shift+j move down 30 px
bindsym $mod+Shift+k move up 30 px
bindsym $mod+Shift+l move right 30 px

bindsym $mod+f fullscreen toggle
bindsym $mod+Shift+f floating toggle
bindsym $mod+Shift+p sticky toggle

# change focus between tiling / floating windows
bindsym $mod+Control+space focus mode_toggle

# App launcher - configured in fuzzel.ini
bindsym $mod+space exec fuzzel

# Set defaults
default_orientation horizontal
workspace_layout tabbed

# Configure gaps and borders
default_border pixel 1
gaps outer 0
gaps inner 6
smart_borders off
hide_edge_borders --i3 none 

# Define variables for workspace numbers
set $ws0 0
set $ws1 1
set $ws2 2
set $ws3 3
set $ws4 4
set $ws5 5

# Move specific workspaces to outputs
workspace $ws0 output $laptop
workspace $ws2 output $primary $laptop
workspace $ws3 output $laptop
workspace $ws4 output $laptop
workspace $ws5 output $laptop
workspace $ws1 output $primary $laptop # Set ws 1 last to land there on startup

# Switch to workspace
bindsym $mod+grave workspace $ws0
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5

# Move focused container to workspace
bindsym $mod+Shift+grave move container to workspace $ws0
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5

# Brightness control
bindsym --locked  XF86MonBrightnessDown exec brightnessctl set 5%-
bindsym --release XF86MonBrightnessDown exec pkill -SIGRTMIN+4 -n gubar
bindsym --locked  XF86MonBrightnessUp exec brightnessctl set 5%+
bindsym --release XF86MonBrightnessUp  exec pkill -SIGRTMIN+4 -n gubar

# Volume control
bindsym --locked  XF86AudioMute exec pactl set-sink-mute @DEFAULT_SINK@ toggle
bindsym --release XF86AudioMute exec pkill -SIGRTMIN+2 -n gubar
bindsym --locked  XF86AudioLowerVolume exec pactl set-sink-volume @DEFAULT_SINK@ -5%
bindsym --release XF86AudioLowerVolume exec pkill -SIGRTMIN+2 -n gubar
bindsym --locked  XF86AudioRaiseVolume exec pactl set-sink-volume @DEFAULT_SINK@ +5%
bindsym --release XF86AudioRaiseVolume exec pkill -SIGRTMIN+2 -n gubar

# bindsym --locked XF86AudioMute exec wpctl set-mute \@DEFAULT_AUDIO_SINK@ toggle
# bindsym --locked XF86AudioLowerVolume exec wpctl set-volume \@DEFAULT_AUDIO_SINK@ 5%-
# bindsym --locked XF86AudioRaiseVolume exec wpctl set-volume \@DEFAULT_AUDIO_SINK@ 5%+
# bindsym --locked XF86AudioMicMute exec wpctl set-mute \@DEFAULT_AUDIO_SOURCE@ toggle

# Audio Player controls
bindsym --locked XF86AudioPlay exec playerctl play-pause
bindsym --locked XF86AudioNext exec playerctl next
bindsym --locked XF86AudioPrev exec playerctl previous

# Screenshots
bindsym Print exec grimshot --notify save output
bindsym Alt+Print exec grimshot --notify save area

set $bgcolor #1d1f21dd
set $bordercolor #5e81accc


# Style the UI
client.focused $bordercolor $bgcolor #ffffffff #ffffffff #5e81accc
client.unfocused $bordercolor #1c1f2bef #ffffffff #ffffffff #5e81accc

# Set up screen locking
set $lock 'swaylock -f --screenshots --clock \
          --effect-blur 9x7 --effect-vignette 0.25:0.5 \
          --grace 60 --fade-in 0.25'

set $qlock 'swaylock -f --screenshots --clock \
           --effect-blur 9x7 --effect-vignette 0.25:0.5'

exec swayidle -w \
  timeout 900 $lock \
  timeout 960 'swaymsg "output * dpms off"' \
  resume 'swaymsg "output * dpms on"' \
  before-sleep $lock

# Lock Screen
bindsym $mod+Shift+o exec $qlock

# Sway Session Controls
bindsym $mod+Shift+space exec wlogout -p layer-shell

# Night Light (CA lat/long)
exec wlsunset -l 34.1 -L -117.7

# Window rules
for_window [title="Firefox â€” Sharing Indicator"] kill
for_window [title=".* - mpv$"] floating enable, sticky enable

# Status Bar (swaybar)
bar {
    position top
    # mode hide
    font pango:JetBrains Mono 11
    icon_theme "Qogir-Dark"

    # Use sway's default status bar --> swaybar
    # status_command while ~/.config/sway/bin/swaybar-status.sh; do sleep 0.25; done
    status_command gubar

    tray_bindsym button1 Activate
    tray_bindsym button2 ContextMenu

    colors {
        statusline #eceff4
        background #2e3440
        focused_workspace #81a1c1 #5e81ac #eceff4
        active_workspace #81a1c1 #5e81ac #eceff4
        inactive_workspace #2e3440 #4c566a #d8dee9
    }
}

# Autostart Utility Applications
exec mako
# exec nm-applet --indicator
exec udiskie -s
exec blueman-applet # Open Guix Issue: https://issues.guix.gnu.org/71528


#
# Other
#

# Update DBUS activation records to ensure Flatpak apps work
exec dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=sway

# Diable xwayland?
# xwayland disable

# Load system-specific configuration
#include "~/.config/sway/systems/$(hostname)"

#include "~/.config/sway/after-config"

